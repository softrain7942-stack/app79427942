<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Pi App</title>
</head>
<body>
    <h1>Hello Pi Network</h1>
    <p>This is my Pi App.</p>

    <!-- Pi SDK 로드 -->
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>

    <!-- Pi SDK 초기화 + 로그인 함수 -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            if (!window.Pi) {
                console.error("Pi SDK not loaded");
                alert("Pi SDK 로드 실패! 네트워크 상태 확인 필요.");
                return;
            }

            const Pi = window.Pi;

            // SDK 초기화 (테스트 모드)
            Pi.init({ version: "2.0", sandbox: true });

            function onIncompletePaymentFound(payment) {
                console.log("미완료 결제 발견:", payment);
                return Pi.completePayment(payment.paymentId, { txid: null });
            }

            window.piLogin = async function() {
                try {
                    const scopes = ['username', 'payments']; // username / payments 권한 요청
                    const authResult = await Pi.authenticate(scopes, onIncompletePaymentFound);

                    console.log("로그인 성공! UID:", authResult.user.uid);
                    console.log("유저 정보:", authResult.user);
                    console.log("액세스 토큰:", authResult.accessToken);

                    alert("Pi 로그인 성공! UID: " + authResult.user.uid);
                } catch (err) {
                    console.error("로그인 실패:", err);
                    alert("로그인 실패: " + (err && err.message ? err.message : "알 수 없는 오류"));
                }
            };
        });
    </script>

    <!-- 로그인 버튼 -->
    <button onclick="piLogin()">Pi로 로그인</button>

</body>
</html>
